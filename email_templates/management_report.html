<table width="100%" cellpadding="0" cellspacing="0" border="0" style="max-width: 800px; margin: 0 auto; font-family: Arial, sans-serif;">
  <tr>
    <!-- Original blue background -->
    <td style="background: #0792d0; padding: 30px; border-radius: 12px;">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td>
            <div style="color: #ffffff;">Weekly Sales Report - {{report_date}}</div>
          </td>
          <td style="text-align: right;">
            <img src="{{logo_base64}}" width="100" height="100" style="display: inline-block;" alt="Company Logo">
          </td>
        </tr>
      </table>
    </td>
  </tr>

  <!-- Company Overview section -->
  <tr>
    <td style="padding-top: 24px;">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td width="33%" style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
            <div style="font-size: 14px; color: #4a5568;">Total Assigned Revenue</div>
            <div style="font-size: 24px; font-weight: 700; color: #2b6cb0;">${{ total_revenue }}</div>
            {% if total_previous_year_revenue_raw is defined and total_previous_year_revenue_raw > 0 %}
              <div style="font-size: 12px; margin-top: 4px; color: {{ total_year_over_year_change > 0 and '#059669' or '#dc2626' }}">
                vs ${{ total_previous_year_revenue }} last year
                ({{ total_year_over_year_change > 0 and '+' or '' }}{{ total_year_over_year_change | round }}%)
              </div>
            {% endif %}
          </td>
          <td width="33%" style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
            <div style="font-size: 14px; color: #4a5568;">Total Customers</div>
            <div style="font-size: 24px; font-weight: 700; color: #2b6cb0;">{{ total_customers }}</div>
            {% if previous_year_customers > 0 %}
              <div style="font-size: 12px; margin-top: 4px; color: {{ total_customers > previous_year_customers and '#059669' or '#dc2626' }}">
                vs {{ previous_year_customers }} last year
                ({{ total_customers > previous_year_customers and '+' or '' }}{{ ((total_customers - previous_year_customers) / previous_year_customers * 100) | round }}%)
              </div>
            {% endif %}
          </td>
          <td width="33%" style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
            <div style="font-size: 14px; color: #4a5568;">Total Unassigned</div>
            <div style="font-size: 24px; font-weight: 700; color: #2b6cb0;">${{ total_unassigned_revenue }}</div>
          </td>
        </tr>
      </table>
    </td>
  </tr>

  <!-- AE Sections -->
  {% for ae in ae_data %}
  <tr>
    <td style="padding-top: 32px;">
      <h2 style="font-size: 20px; color: #333333; margin: 0 0 20px 0;">{{ae.name}}'s Performance</h2>
      
      <!-- AE Overview Stats -->
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td width="33%" style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
            <div style="font-size: 14px; color: #4a5568;">Total Revenue</div>
            <div style="font-size: 24px; font-weight: 700; color: #2b6cb0;">${{ ae.total_assigned_revenue }}</div>
            {% if ae.previous_year_revenue_raw > 0 %}
              <div style="font-size: 12px; margin-top: 4px; color: {{ ae.year_over_year_change > 0 and '#059669' or '#dc2626' }}">
                vs ${{ ae.previous_year_revenue }} last year
                ({{ ae.year_over_year_change > 0 and '+' or '' }}{{ ae.year_over_year_change | round }}%)
              </div>
            {% endif %}
          </td>
          <td width="33%" style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
            <div style="font-size: 14px; color: #4a5568;">Total Customers</div>
            <div style="font-size: 24px; font-weight: 700; color: #2b6cb0;">{{ ae.total_customers }}</div>
            {% if ae.previous_year_customers > 0 %}
              <div style="font-size: 12px; margin-top: 4px; color: {{ ae.total_customers > ae.previous_year_customers and '#059669' or '#dc2626' }}">
                vs {{ ae.previous_year_customers }} last year
                ({{ ae.total_customers > ae.previous_year_customers and '+' or '' }}{{ ((ae.total_customers - ae.previous_year_customers) / ae.previous_year_customers * 100) | round }}%)
              </div>
            {% endif %}
          </td>
          <td width="33%" style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
            <div style="font-size: 14px; color: #4a5568;">Total Budget</div>
            <div style="font-size: 24px; font-weight: 700; color: #2b6cb0;">${{ ae.total_budget }}</div>
          </td>
        </tr>
      </table>

      <!-- Quarterly Table -->
      <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin-top: 24px; border-collapse: collapse;">
        <thead>
          <tr>
            <th style="text-align: left; padding: 12px; background: #f8fafc; border-bottom: 2px solid #e2e8f0; color: #1f2937; font-weight: 600;">Quarter</th>
            <th style="text-align: left; padding: 12px; background: #f8fafc; border-bottom: 2px solid #e2e8f0; color: #1f2937; font-weight: 600;">Progress</th>
            <th style="text-align: right; padding: 12px; background: #f8fafc; border-bottom: 2px solid #e2e8f0; color: #1f2937; font-weight: 600;">Assigned</th>
            <th style="text-align: right; padding: 12px; background: #f8fafc; border-bottom: 2px solid #e2e8f0; color: #1f2937; font-weight: 600;">YoY Change</th>
            <th style="text-align: right; padding: 12px; background: #f8fafc; border-bottom: 2px solid #e2e8f0; color: #1f2937; font-weight: 600;">Unassigned</th>
            <th style="text-align: right; padding: 12px; background: #f8fafc; border-bottom: 2px solid #e2e8f0; color: #1f2937; font-weight: 600;">Budget</th>
          </tr>
        </thead>
        <tbody>
          {% for quarter in ae.quarters %}
          <tr>
            <td style="padding: 12px; border-bottom: 1px solid #e2e8f0; color: #4b5563;">{{ quarter.name }}</td>
            <td style="padding: 8px 12px; border-bottom: 1px solid #e2e8f0;">
              <div style="width: 100%; height: 24px; background: #e2e8f0; position: relative; border-radius: 4px; overflow: hidden;">
                <div style="height: 100%; background: #3b82f6; position: absolute; left: 0; top: 0; width: {{ quarter.completion_percentage }}%;">
                  <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: #ffffff; font-weight: 600; font-size: 12px; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">{{ quarter.completion_percentage }}%</span>
                </div>
              </div>
            </td>
            <td style="text-align: right; padding: 12px; border-bottom: 1px solid #e2e8f0; color: #4b5563; font-family: monospace; font-size: 14px;">
              ${{ quarter.assigned }}
              {% if quarter.previous_year_assigned_raw > 0 %}
                  <div style="font-size: 12px; color: {{ quarter.year_over_year_change > 0 and '#059669' or '#dc2626' }}">
                      vs ${{ quarter.previous_year_assigned }}                      
                  </div>
              {% endif %}
            </td>
            <td style="text-align: right; padding: 12px; border-bottom: 1px solid #e2e8f0; font-family: monospace; font-size: 14px; {% if quarter.year_over_year_change > 0 %}color: #059669{% else %}color: #dc2626{% endif %}">
              {% if quarter.previous_year_assigned_raw > 0 %}
                {{ quarter.year_over_year_change > 0 and '+' or '' }}{{ quarter.year_over_year_change | round }}%
              {% else %}
                --
              {% endif %}
            </td>
            <td style="text-align: right; padding: 12px; border-bottom: 1px solid #e2e8f0; color: #4b5563; font-family: monospace; font-size: 14px;">${{ quarter.unassigned }}</td>
            <td style="text-align: right; padding: 12px; border-bottom: 1px solid #e2e8f0; color: #4b5563; font-family: monospace; font-size: 14px;">${{ quarter.budget }}</td>
          </tr>
          {% endfor %}
          <!-- After quarterly rows -->
          <tr style="background-color: #f1f5f9; font-weight: 600;">
            <td style="padding: 12px; border-bottom: 2px solid #e2e8f0; color: #1f2937;">{{ ae.annual_totals.name }}</td>
            <td style="padding: 8px 12px; border-bottom: 2px solid #e2e8f0;">
              <div style="width: 100%; height: 24px; background: #e2e8f0; position: relative; border-radius: 4px; overflow: hidden;">
                <div style="height: 100%; background: #2563eb; position: absolute; left: 0; top: 0; width: {{ ae.annual_totals.completion_percentage }}%;">
                  <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: #ffffff; font-weight: 600; font-size: 12px; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">{{ ae.annual_totals.completion_percentage }}%</span>
                </div>
              </div>
            </td>
            <td style="text-align: right; padding: 12px; border-bottom: 2px solid #e2e8f0; color: #1f2937; font-family: monospace; font-size: 14px;">${{ ae.annual_totals.assigned }}</td>
            <td style="text-align: right; padding: 12px; border-bottom: 2px solid #e2e8f0; font-family: monospace; font-size: 14px; {% if ae.annual_totals.year_over_year_change > 0 %}color: #059669{% else %}color: #dc2626{% endif %}">
              {{ ae.annual_totals.year_over_year_change > 0 and '+' or '' }}{{ ae.annual_totals.year_over_year_change | round }}%
            </td>
            <td style="text-align: right; padding: 12px; border-bottom: 2px solid #e2e8f0; color: #1f2937; font-family: monospace; font-size: 14px;">${{ ae.annual_totals.unassigned }}</td>
            <td style="text-align: right; padding: 12px; border-bottom: 2px solid #e2e8f0; color: #1f2937; font-family: monospace; font-size: 14px;">${{ ae.annual_totals.budget }}</td>
          </tr>
        </tbody>
      </table>
    </td>
  </tr>
  {% endfor %}

  <!-- Note Section -->
  <tr>
    <td style="padding-top: 24px;">
      <div style="background: #fff5f5; border-left: 4px solid #fc8181; padding: 16px;">
        <strong>Note:</strong> This report shows GROSS revenue figures.
      </div>
    </td>
  </tr>
</table>