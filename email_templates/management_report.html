<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Report</title>
    <style>
      body, table, td {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }
    table {
        border-collapse: collapse;
    }
    .header-container {
      width: 100%;  /* Ensure full width */
      max-width: 900px;  /* Match container */
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #2b6cb0;
      color: white;
      padding: 20px;
      box-sizing: border-box; /* Ensures padding doesn't expand width */
  }
  
  .header-title {
      font-size: 22px;
      font-weight: bold;
      margin: 0;
      flex: 1;  /* Pushes the logo to the right */
  }
  .header-logo {
      display: flex;
      justify-content: flex-end;
  }
  .header-logo img {
      width: 100px;
      height: 100px;
  }
  .container {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      background: white;
  }
  
  
    .section {
        padding: 20px;
        border-bottom: 2px solid #e2e8f0;
    }
    .table-responsive {
        width: 100%;
    }
    .table-responsive th {
        background: #f8fafc;
        text-align: left;
        padding: 10px;
        border-bottom: 2px solid #e2e8f0;
    }
    .table-responsive td {
        padding: 10px;
        border-bottom: 1px solid #e2e8f0;
    }
    .highlight {
        background: #f1f5f9;
        font-weight: bold;
    }
    .progress-bar {
        background: #e2e8f0;
        width: 100%;
        height: 24px;
        border-radius: 4px;
        position: relative;
    }
    .progress-bar div {
        background: #3b82f6;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
    }

    </style>
</head>
<body style="background-color: #f3f4f6; padding: 20px;">
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="max-width: 900px; background: #2b6cb0; color: white; margin: 0 auto;">
    <tr>
        <td style="padding: 20px; font-size: 22px; font-weight: bold;">Management Performance Report</td>
        <td align="right" style="padding: 20px;">
            <img src="cid:company_logo" alt="Company Logo" width="100" height="100">
        </td>
    </tr>
</table>


  <!-- Main Content Table -->
  <table class="container" cellpadding="0" cellspacing="0" border="0">
      <tr>
          <td class="section">
              <h2 style="font-size: 20px; color: #333;">Company Performance</h2>

              <!-- Company Overview Stats -->
              <table class="table-responsive" cellpadding="0" cellspacing="0" border="0" width="100%">
                  <tr>
                      <td width="33%" align="center" style="padding: 16px; background: #f8fafc;">
                          <div style="font-size: 14px; color: #4a5568;">Total Revenue</div>
                          <div style="font-size: 24px; font-weight: bold; color: #2b6cb0;">${{ total_revenue }}</div>
                          {% if total_previous_year_revenue_raw > 0 %}
                          <div style="font-size: 12px; margin-top: 4px; color: {{ total_year_over_year_change >= 0 and '#059669' or '#dc2626' }};">
                              vs ${{ total_previous_year_revenue }} last year 
                              ({{ total_year_over_year_change >= 0 and '+' or '' }}{{ '%0.1f' | format(total_year_over_year_change) }}%)
                          </div>
                          {% endif %}
                      </td>
                      <td width="33%" align="center" style="padding: 16px; background: #f8fafc;">
                          <div style="font-size: 14px; color: #4a5568;">Total Customers</div>
                          <div style="font-size: 24px; font-weight: bold; color: #2b6cb0;">{{ total_customers }}</div>
                          {% if previous_year_customers > 0 %}
                          <div style="font-size: 12px; margin-top: 4px; color: {{ total_customers > previous_year_customers and '#059669' or '#dc2626' }};">
                              vs {{ previous_year_customers }} last year 
                              ({{ ((total_customers - previous_year_customers) / previous_year_customers * 100) | round(1) }}%)
                          </div>
                          {% endif %}
                      </td>
                      <td width="33%" align="center" style="padding: 16px; background: #f8fafc;">
                          <div style="font-size: 14px; color: #4a5568;">Total Budget</div>
                          <div style="font-size: 24px; font-weight: bold; color: #2b6cb0;">${{ company_total_budget }}</div>
                      </td>
                  </tr>
              </table>
          </td>
      </tr>
        <!-- Company Quarterly Performance Table -->
        <tr>
          <td class="section">
              <table class="table-responsive" cellpadding="0" cellspacing="0" border="0" width="100%">
                  <thead>
                      <tr>
                          <th>Quarter</th>
                          <th>Progress</th>
                          <th align="right">Assigned</th>
                          <th align="right">YoY Change</th>
                          <th align="right">Unassigned</th>
                          <th align="right">Budget</th>
                      </tr>
                  </thead>
                  <tbody>
                      {% for quarter in company_quarters %}
                      <tr>
                          <td>{{ quarter.name }}</td>
                          <td>
                              <div class="progress-bar">
                                  <div style="width: {{ quarter.completion_percentage }}%;">
                                      <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: #fff; font-weight: bold; font-size: 12px;">
                                          {{ quarter.completion_percentage }}%
                                      </span>
                                  </div>
                              </div>
                          </td>
                          <td align="right">${{ quarter.assigned }}</td>
                          <td align="right" style="color: {{ quarter.year_over_year_change >= 0 and '#059669' or '#dc2626' }};">
                              {% if quarter.previous_year_assigned_raw > 0 %}
                                  {{ quarter.year_over_year_change >= 0 and '+' or '' }}{{ '%0.1f' | format(quarter.year_over_year_change) }}%
                              {% else %}
                                  --
                              {% endif %}
                          </td>
                          <td align="right">${{ quarter.unassigned }}</td>
                          <td align="right">${{ quarter.budget }}</td>
                      </tr>
                      {% endfor %}
                      <tr class="highlight">
                          <td>Annual Total</td>
                          <td>
                              <div class="progress-bar">
                                  <div style="width: {{ company_completion_percentage }}%;">
                                      <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: #fff; font-weight: bold; font-size: 12px;">
                                          {{ company_completion_percentage }}%
                                      </span>
                                  </div>
                              </div>
                          </td>
                          <td align="right">${{ total_revenue }}</td>
                          <td align="right" style="color: {{ total_year_over_year_change >= 0 and '#059669' or '#dc2626' }};">
                              {{ total_year_over_year_change >= 0 and '+' or '' }}{{ '%0.1f' | format(total_year_over_year_change) }}%
                          </td>
                          <td align="right">${{ total_unassigned_revenue }}</td>
                          <td align="right">${{ company_total_budget }}</td>
                      </tr>
                  </tbody>
              </table>
          </td>
      </tr>
        <!-- Individual AE Performance Sections -->
        {% for ae in ae_data %}
        <tr>
            <td class="section">
                <h2 style="font-size: 20px; color: #333;">{{ ae.name }}'s Performance</h2>

                <!-- AE Overview Stats -->
                <table class="table-responsive" cellpadding="0" cellspacing="0" border="0" width="100%">
                    <tr>
                        <td width="33%" align="center" style="padding: 16px; background: #f8fafc;">
                            <div style="font-size: 14px; color: #4a5568;">Total Revenue</div>
                            <div style="font-size: 24px; font-weight: bold; color: #2b6cb0;">${{ ae.total_assigned_revenue }}</div>
                            {% if ae.previous_year_revenue_raw > 0 %}
                            <div style="font-size: 12px; margin-top: 4px; color: {{ ae.year_over_year_change >= 0 and '#059669' or '#dc2626' }};">
                                vs ${{ ae.previous_year_revenue_display }} last year 
                                ({{ ae.year_over_year_change >= 0 and '+' or '' }}{{ '%0.1f' | format(ae.year_over_year_change) }}%)
                            </div>
                            {% endif %}
                        </td>
                        <td width="33%" align="center" style="padding: 16px; background: #f8fafc;">
                            <div style="font-size: 14px; color: #4a5568;">Total Customers</div>
                            <div style="font-size: 24px; font-weight: bold; color: #2b6cb0;">{{ ae.total_customers }}</div>
                            {% if ae.previous_year_customers > 0 %}
                            <div style="font-size: 12px; margin-top: 4px; color: {{ ae.total_customers > ae.previous_year_customers and '#059669' or '#dc2626' }};">
                                vs {{ ae.previous_year_customers }} last year 
                                ({{ ((ae.total_customers - ae.previous_year_customers) / ae.previous_year_customers * 100) | round(1) }}%)
                            </div>
                            {% endif %}
                        </td>
                        <td width="33%" align="center" style="padding: 16px; background: #f8fafc;">
                            <div style="font-size: 14px; color: #4a5568;">Total Budget</div>
                            <div style="font-size: 24px; font-weight: bold; color: #2b6cb0;">${{ ae.total_budget }}</div>
                        </td>
                    </tr>
                </table>

                <!-- AE Quarterly Performance Table -->
                <table class="table-responsive" cellpadding="0" cellspacing="0" border="0" width="100%">
                    <thead>
                        <tr>
                            <th>Quarter</th>
                            <th>Progress</th>
                            <th align="right">Assigned</th>
                            <th align="right">YoY Change</th>
                            <th align="right">Unassigned</th>
                            <th align="right">Budget</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for quarter in ae.quarters %}
                        <tr>
                            <td>{{ quarter.name }}</td>
                            <td>
                                <div class="progress-bar">
                                    <div style="width: {{ quarter.completion_percentage }}%;">
                                        <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: #fff; font-weight: bold; font-size: 12px;">
                                            {{ quarter.completion_percentage }}%
                                        </span>
                                    </div>
                                </div>
                            </td>
                            <td align="right">${{ quarter.assigned }}</td>
                            <td align="right" style="color: {{ quarter.year_over_year_change >= 0 and '#059669' or '#dc2626' }};">
                                {% if quarter.previous_year_assigned_raw > 0 %}
                                    {{ quarter.year_over_year_change >= 0 and '+' or '' }}{{ '%0.1f' | format(quarter.year_over_year_change) }}%
                                {% else %}
                                    --
                                {% endif %}
                            </td>
                            <td align="right">${{ quarter.unassigned }}</td>
                            <td align="right">${{ quarter.budget }}</td>
                        </tr>
                        {% endfor %}
                        <tr class="highlight">
                            <td>Annual Total</td>
                            <td>
                                <div class="progress-bar">
                                    <div style="width: {{ ae.annual_totals.completion_percentage }}%;">
                                        <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: #fff; font-weight: bold; font-size: 12px;">
                                            {{ ae.annual_totals.completion_percentage }}%
                                        </span>
                                    </div>
                                </div>
                            </td>
                            <td align="right">${{ ae.annual_totals.assigned }}</td>
                            <td align="right" style="color: {{ ae.annual_totals.year_over_year_change >= 0 and '#059669' or '#dc2626' }};">
                                {{ ae.annual_totals.year_over_year_change >= 0 and '+' or '' }}{{ '%0.1f' | format(ae.annual_totals.year_over_year_change) }}%
                            </td>
                            <td align="right">${{ ae.annual_totals.unassigned }}</td>
                            <td align="right">${{ ae.annual_totals.budget }}</td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
        {% endfor %}
        <!-- Note Section -->
        <tr>
          <td class="section">
              <table class="table-responsive" cellpadding="0" cellspacing="0" border="0" width="100%">
                  <tr>
                      <td style="background: #fff5f5; border-left: 4px solid #fc8181; padding: 16px;">
                          <strong>Note:</strong> This report shows GROSS revenue figures.
                      </td>
                  </tr>
              </table>
          </td>
      </tr>
  </table>
</body>
</html>
